<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banana Reports ‚Äî Scanner</title>

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/style.css">

  <script src="https://unpkg.com/@zxing/library@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body data-mode="scanner">
  <button id="globalMenuBtn" class="global-menu-btn">‚ò∞</button>

  <div id="globalMenu" class="global-menu">
    <div class="global-menu__content">
      <h3 class="global-menu__title">Menu</h3>
      <button class="global-menu__item" onclick="location.href='/index.html'">‚Üê Back to Home</button>
      <button class="global-menu__item" id="cancelTaskBtn">‚úñ Cancel Task</button>
      <button class="global-menu__close" id="closeGlobalMenu">Close</button>
    </div>
  </div>

  <div class="wizard">

    <!-- STEP 0 -->
    <div class="wizard__step active" id="step0">
      <h2 class="wizard__title">Step 1 ‚Äî Connect Mobile Scanner</h2>
      <div class="wizard__content">
        <div class="scanner-qr">
          <h3 class="scanner-qr__title">üì± Phone Connection</h3>
          <p class="scanner-qr__description">Scan the QR code with your phone to open the mobile scanner.</p>
          <div class="scanner-qr__box">
            <div id="qrBox" class="scanner-qr__code"></div>
            <div id="qrStatus" class="scanner-qr__status"></div>
          </div>
          <div id="qrDeviceStatus" class="qr-panel__device">
            <span class="qr-device__dot"></span>
            <span class="qr-device__text">No device connected</span>
          </div>
        </div>
      </div>
      <div class="wizard__button-row">
        <button class="wizard__back button button--secondary button--full">‚Üê Back</button>
        <button class="wizard__next button button--primary button--full">Continue ‚Üí</button>
        <button class="button button--secondary button--full" onclick="exitTaskSafely()">‚úñ Close</button>
      </div>
    </div>

    <!-- STEP 1 -->
    <div class="wizard__step" id="step1">
      <h2 class="wizard__title">Step 2 ‚Äî Select Date & Client</h2>
      <div class="wizard__content">
        <label class="form__label">Date:
          <input type="date" id="scanDate" class="input">
        </label>

        <button id="loadOrders" class="button button--primary button--full">Load Orders</button>

        <label class="form__label">Client:
          <select id="clientSelect" class="select">
            <option value="">‚Äî select a client ‚Äî</option>
          </select>
        </label>

        <div id="orderStatus" class="wizard__info"></div>
      </div>

      <div class="wizard__button-row">
        <button class="wizard__back button button--secondary button--full">‚Üê Back</button>
        <button class="wizard__next button button--primary button--full">Next ‚Üí</button>
        <button class="button button--secondary button--full" onclick="exitTaskSafely()">‚úñ Close</button>
      </div>
    </div>

    <!-- STEP 2 -->
    <div class="wizard__step" id="step2">
      <h2 class="wizard__title">Step 3 ‚Äî Confirm Pallet Info</h2>
      <div class="wizard__content">
        <label class="form__label">Pallet Type:
          <select id="palletType" class="select">
            <option value="EURO PALLETS">Euro</option>
            <option value="IND. PALLETS">Industrial</option>
            <option value="PHP mini">PHP mini</option>
          </select>
        </label>

        <label class="form__label">Boxes per pallet:
          <input type="number" id="palletHeight" class="input">
        </label>

        <label class="form__label">Number of rows:
          <input type="number" id="rowsCount" class="input" value="1">
        </label>

        <div id="rowCheck" class="wizard__info"></div>
      </div>

      <div class="wizard__button-row">
        <button class="wizard__back button button--secondary button--full">‚Üê Back</button>
        <button class="wizard__next button button--primary button--full">Next ‚Üí</button>
        <button class="button button--secondary button--full" onclick="exitTaskSafely()">‚úñ Close</button>
      </div>
    </div>

    <!-- STEP 3 -->
    <div class="wizard__step" id="step3">
      <h2 class="wizard__title">Step 4 ‚Äî Select Mode</h2>
      <div class="wizard__content">
        <label class="form__label">Mode:
          <select id="scanMode" class="select">
            <option value="auto">AUTO ‚Äî fast scanning</option>
            <option value="manual">MANUAL ‚Äî adjustable quantity</option>
          </select>
        </label>

        <div class="wizard__info">
          AUTO ‚Üí always +1<br>
          MANUAL ‚Üí editable quantity
        </div>
      </div>

      <div class="wizard__button-row">
        <button class="wizard__back button button--secondary button--full">‚Üê Back</button>
        <button class="wizard__next button button--primary button--full">Start scanning ‚Üí</button>
        <button class="button button--secondary button--full" onclick="exitTaskSafely()">‚úñ Close</button>
      </div>
    </div>

    <!-- STEP 4 -->
    <div class="wizard__step" id="step4">
      <h2 class="wizard__title">Step 5 ‚Äî Scanning</h2>

      <div class="wizard__content">

        <div class="pallet-sides">
          <label class="form__label">Side 1:
            <input type="number" id="side1" class="input">
          </label>

          <label class="form__label">Side 2:
            <input type="number" id="side2" class="input">
          </label>
        </div>

        <div class="side-info">
          <div id="side1Info" class="wizard__info"></div>
          <div id="side2Info" class="wizard__info"></div>
        </div>

        <button id="startVideoScanner" class="button button--primary button--full">üé• Start Scanner</button>

        <div id="containerInfo" class="wizard__info"></div>

        <div id="palletCheck" class="wizard__info"></div>

        <div class="progress-container">
          <div id="progressBar" class="progress-bar"></div>
        </div>

        <div class="side-progress">
          <div id="side1Bar" class="side-bar"></div>
          <div id="side2Bar" class="side-bar"></div>
        </div>

        <input type="text" id="scanInput" class="input" placeholder="Scanned code">
        <div id="log" class="wizard__log"></div>

      </div>

      <div class="wizard__button-row">
        <button class="wizard__back button button--secondary button--full">‚Üê Back</button>
        <button id="finishBtn" class="button button--primary button--full">Finish</button>
        <button class="button button--secondary button--full" onclick="exitTaskSafely()">‚úñ Close</button>
      </div>


      <div id="reportStatus" class="scan-status"></div>
    </div>

    <!-- STEP 5 -->
    <div class="wizard__step" id="step5">
      <h2 class="wizard__title">Step 6 ‚Äî Summary</h2>

      <div class="wizard__content">
        <div id="finalReport" class="report-box"></div>
        <div id="summary" class="wizard__info"></div>

        <button id="generateReportBtn" class="button button--primary button--full">Generate Report</button>
        <button id="downloadReportBtn" class="button button--primary button--full">‚¨á Download</button>
      </div>

      <div class="wizard__button-row">
        <button class="wizard__back button button--secondary button--full">‚Üê Back</button>
        <button class="button button--secondary button--full" onclick="exitTaskSafely()">‚úñ Close</button>
      </div>
    </div>

  </div>

  <!-- MANUAL CONFIRM POPUP -->
  <div id="manualConfirm" class="popup">
    <div class="popup__content">
      <div class="popup__title">Scanned code:</div>
      <div id="popupCode" class="popup__code"></div>

      <div class="popup__title">Quantity:</div>
      <div id="popupQty" class="popup__qty">1</div>

      <div class="popup__actions">
        <button id="popupOk" class="button button--primary">OK</button>
        <button id="popupEdit" class="button button--secondary">Edit</button>
      </div>
    </div>
  </div>

  <div id="manualKeyboard" class="popup keypad">
    <div class="popup__content keypad__content">

      <div class="popup__title">Enter quantity</div>
      <div id="keypadDisplay" class="keypad__display">1</div>

      <div class="keypad__grid">
        <button class="keypad__btn">1</button>
        <button class="keypad__btn">2</button>
        <button class="keypad__btn">3</button>

        <button class="keypad__btn">4</button>
        <button class="keypad__btn">5</button>
        <button class="keypad__btn">6</button>

        <button class="keypad__btn">7</button>
        <button class="keypad__btn">8</button>
        <button class="keypad__btn">9</button>

        <button class="keypad__btn keypad__clear">C</button>
        <button class="keypad__btn">0</button>
        <button class="keypad__btn keypad__back">‚Üê</button>
      </div>

      <div class="popup__actions">
        <button id="keypadOk" class="button button--primary">OK</button>
        <button id="keypadCancel" class="button button--secondary">Cancel</button>
      </div>

    </div>
  </div>

  <!-- FULLSCREEN VIDEO SCANNER -->
  <div id="scannerOverlay" class="scanner-overlay">

    <div class="scan-frame"></div>

    <video id="video" autoplay playsinline muted></video>

    <div class="overlay-dark"></div>

    <div class="overlay-frame">
      <div class="corner tl"></div>
      <div class="corner tr"></div>
      <div class="corner bl"></div>
      <div class="corner br"></div>
    </div>

    <div class="overlay-laser"></div>

    <div id="overlayFlash" class="overlay-flash"></div>

    <div class="overlay-top">
      <div id="overlayContainerInfo" class="overlay-info"></div>
      <div id="overlayPalletCheck" class="overlay-info"></div>
    </div>

    <div class="overlay-progress">
      <div id="overlayProgressBar" class="overlay-progress__bar"></div>
    </div>

    <div class="overlay-qty">
      <span>Qty:</span>
      <span id="overlayQtyValue">1</span>
    </div>

    <div id="overlayLog" class="overlay-log"></div>

    <div class="overlay-buttons">
      <button id="flashToggle" class="overlay-btn">üî¶</button>

      <!-- üî• –î–æ–¥–∞—î–º–æ –∫–Ω–æ–ø–∫—É –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è —Ä–µ–∂–∏–º—É -->
      <button id="toggleScanMode" class="overlay-btn overlay-btn--mode">AUTO</button>

      <button id="stopVideoScanner" class="overlay-btn overlay-btn--stop">‚úñ</button>
      <button id="closeScanner" class="overlay-btn overlay-btn--close">Close</button>
    </div>


  </div>

  <script type="module" src="/js/scanner.js"></script>
</body>

</html>