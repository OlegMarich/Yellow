<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Banana Reports ‚Äî Scanner</title>

  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">

  <link rel="stylesheet" href="/css/reset.css">
  <link rel="stylesheet" href="/css/style.css">

  <script src="https://unpkg.com/@zxing/library@latest"></script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body data-mode="scanner">
  <button id="globalMenuBtn" class="global-menu-btn">‚ò∞</button>

  <div id="globalMenu" class="global-menu">
    <div class="global-menu__content">

      <h3 class="global-menu__title">Menu</h3>

      <button class="global-menu__item" onclick="location.href='/index.html'">
        ‚Üê Back to Home
      </button>

      <button class="global-menu__item" id="cancelTaskBtn">
        ‚úñ Cancel Task
      </button>

      <button class="global-menu__close" id="closeGlobalMenu">
        Close
      </button>

    </div>
  </div>
  <!-- WIZARD STEPS -->
  <div class="wizard">

    <!-- STEP 0 ‚Äî PHONE CONNECTION -->
    <div class="wizard__step" id="step0">
      <h2 class="wizard__title">Step 1 ‚Äî Connect Mobile Scanner</h2>

      <div class="scanner-qr">
        <h3 class="scanner-qr__title">üì± Phone Connection</h3>
        <p class="scanner-qr__description">
          Scan the QR code with your phone to open the mobile scanner.
        </p>

        <div class="scanner-qr__box">
          <div id="qrBox" class="scanner-qr__code"></div>
          <div id="qrStatus" class="scanner-qr__status"></div>
        </div>

        <div id="qrDeviceStatus" class="qr-panel__device">
          <span class="qr-device__dot"></span>
          <span class="qr-device__text">No device connected</span>
        </div>
      </div>

      <button class="wizard__back button button--secondary button--full">
        ‚Üê Back
      </button>

      <button class="wizard__next button button--primary button--full">
        Continue ‚Üí
      </button>

      <button class="button button--secondary button--full" onclick="exitTaskSafely()">
        ‚úñ Close
      </button>
    </div>

    <!-- STEP 1 -->
    <div class="wizard__step" id="step1">
      <h2 class="wizard__title">Step 2 ‚Äî Select Date & Client</h2>

      <label class="form__label">
        Date:
        <input type="date" id="scanDate" class="input">
      </label>

      <button id="loadOrders" class="button button--primary button--full">
        Load Orders
      </button>

      <label class="form__label">
        Client:
        <select id="clientSelect" class="select">
          <option value="">‚Äî select a client ‚Äî</option>
        </select>
      </label>

      <div id="orderStatus" class="wizard__info"></div>

      <button class="wizard__back button button--secondary button--full">
        ‚Üê Back
      </button>

      <button class="wizard__next button button--primary button--full">
        Next ‚Üí
      </button>

      <button class="button button--secondary button--full" onclick="exitTaskSafely()">
        ‚úñ Close
      </button>
    </div>

    <!-- STEP 2 -->
    <div class="wizard__step" id="step2">
      <h2 class="wizard__title">Step 3 ‚Äî Confirm Pallet Info</h2>

      <label class="form__label">
        Pallet Type:
        <select id="palletType" class="select">
          <option value="EURO PALLETS">Euro (4 columns)</option>
          <option value="IND. PALLETS">Industrial (6 columns)</option>
          <option value="PHP mini">PHP mini (2 columns)</option>
        </select>
      </label>

      <label class="form__label">
        Boxes per pallet:
        <input type="number" id="palletHeight" class="input" inputmode="numeric">
      </label>

      <label class="form__label">
        Number of rows:
        <input type="number" id="rowsCount" class="input" value="1" inputmode="numeric">
      </label>

      <div id="rowCheck" class="wizard__info"></div>

      <button class="wizard__back button button--secondary button--full">
        ‚Üê Back
      </button>

      <button class="wizard__next button button--primary button--full">
        Next ‚Üí
      </button>

      <button class="button button--secondary button--full" onclick="exitTaskSafely()">
        ‚úñ Close
      </button>
    </div>

    <!-- STEP 3 -->
    <div class="wizard__step" id="step3">
      <h2 class="wizard__title">Step 4 ‚Äî Select Mode</h2>

      <label class="form__label">
        Mode:
        <select id="scanMode" class="select">
          <option value="auto">AUTO ‚Äî fast scanning</option>
          <option value="manual">MANUAL ‚Äî adjustable quantity</option>
        </select>
      </label>

      <div class="wizard__info">
        AUTO ‚Üí always +1<br>
        MANUAL ‚Üí +1 by default, but editable
      </div>

      <button class="wizard__back button button--secondary button--full">
        ‚Üê Back
      </button>

      <button class="wizard__next button button--primary button--full">
        Start scanning ‚Üí
      </button>

      <button class="button button--secondary button--full" onclick="exitTaskSafely()">
        ‚úñ Close
      </button>
    </div>

    <!-- STEP 4 -->
    <div class="wizard__step" id="step4">
      <h2 class="wizard__title">Step 5 ‚Äî Scanning</h2>

      <div class="pallet-sides">
        <label class="form__label">
          Side 1:
          <input type="number" id="side1" class="input side-input" value="0" inputmode="numeric">
        </label>

        <label class="form__label">
          Side 2:
          <input type="number" id="side2" class="input side-input" value="0" inputmode="numeric">
        </label>
      </div>

      <button id="startVideoScanner" class="button button--primary button--full">
        üé• Start Scanner
      </button>

      <button onclick="reopenLastScanResults()" class="button button--secondary button--full">
        üìÑ View last results
      </button>

      <div id="scanFlash" class="scan-flash">+1</div>

      <div class="progress">
        <div id="progressBar" class="progress__bar"></div>
      </div>

      <div class="side-progress">
        <div class="side-progress__item">
          <label>Side 1</label>
          <div class="progress">
            <div id="side1Bar" class="progress__bar"></div>
          </div>
          <div id="side1Info" class="side-progress__info"></div>
        </div>

        <div class="side-progress__item">
          <label>Side 2</label>
          <div class="progress">
            <div id="side2Bar" class="progress__bar"></div>
          </div>
          <div id="side2Info" class="side-progress__info"></div>
        </div>
      </div>

      <div id="containerInfo" class="wizard__info">
        <b>Container:</b> ‚Äî<br>
        <b>Boxes:</b> 0 / 0
      </div>

      <div id="palletCheck" class="wizard__info"></div>

      <input type="text" id="scanInput" class="input" placeholder="Scanned number..." autocomplete="off">

      <label class="form__label">
        Quantity:
        <div class="qty">
          <input type="number" id="qtyInput" class="input qty__input" value="1" inputmode="numeric">
          <button id="manualPlusBtn" class="button button--primary qty__plus" type="button">+</button>
        </div>
      </label>

      <div id="log" class="wizard__log"></div>

      <button class="wizard__back button button--secondary button--full">
        ‚Üê Back
      </button>

      <button id="finishBtn" class="button button--primary button--full">
        Finish Scanning
      </button>

      <button class="button button--secondary button--full" onclick="exitTaskSafely()">
        ‚úñ Close
      </button>
    </div>

    <!-- STEP 5 -->
    <div class="wizard__step" id="step5">
      <h2 class="wizard__title">Step 6 ‚Äî Summary</h2>

      <div id="finalReport" class="report-box"></div>
      <div id="summary" class="wizard__info"></div>

      <button id="generateReportBtn" class="button button--primary button--full">
        Generate Counter Report
      </button>

      <button id="downloadReportBtn" class="button button--primary button--full">
        ‚¨á Download Counter.xlsx
      </button>

      <button id="openFolderBtn" class="button button--secondary button--full">
        üìÇ Open Folder
      </button>

      <div id="reportStatus" class="wizard__info"></div>

      <button class="button button--secondary button--full" onclick="location.href='/index.html'">
        ‚Üê Back to Home
      </button>

      <button class="wizard__back button button--secondary button--full">
        ‚Üê Back
      </button>

      <button class="button button--secondary button--full" onclick="exitTaskSafely()">
        ‚úñ Close
      </button>
    </div>

  </div>

  <!-- MANUAL CONFIRM POPUP -->
  <div id="manualConfirm" class="popup">
    <div class="popup__content">

      <div class="popup__title">Scanned code:</div>
      <div id="popupCode" class="popup__code"></div>

      <div class="popup__title">Quantity:</div>
      <div id="popupQty" class="popup__qty">1</div>

      <div class="popup__actions">
        <button id="popupOk" class="button button--primary">OK</button>
        <button id="popupEdit" class="button button--secondary">Edit</button>
      </div>

    </div>
  </div>

  <!-- FULLSCREEN VIDEO SCANNER -->
  <div id="scannerOverlay" class="scanner-overlay">
    <div class="scan-frame"></div>
    <!-- VIDEO -->
    <video id="video" autoplay playsinline muted></video>

    <!-- DARK MASK -->
    <div class="overlay-dark"></div>

    <!-- FRAME -->
    <div class="overlay-frame">
      <div class="corner tl"></div>
      <div class="corner tr"></div>
      <div class="corner bl"></div>
      <div class="corner br"></div>
    </div>

    <!-- LASER -->
    <div class="overlay-laser"></div>

    <!-- FLASH -->
    <div id="overlayFlash" class="overlay-flash"></div>

    <!-- TOP INFO -->
    <div class="overlay-top">
      <div id="overlayContainerInfo" class="overlay-info"></div>
      <div id="overlayPalletCheck" class="overlay-info"></div>
    </div>

    <!-- PROGRESS -->
    <div class="overlay-progress">
      <div id="overlayProgressBar" class="overlay-progress__bar"></div>
    </div>

    <!-- QTY -->
    <div class="overlay-qty">
      <span>Qty:</span>
      <span id="overlayQtyValue">1</span>
    </div>

    <!-- LOG -->
    <div id="overlayLog" class="overlay-log"></div>

    <!-- BUTTONS -->
    <div class="overlay-buttons">
      <button id="flashToggle" class="overlay-btn">üî¶</button>
      <button id="stopVideoScanner" class="overlay-btn overlay-btn--stop">‚úñ</button>
      <button id="closeScanner" class="overlay-btn overlay-btn--close">Close</button>
    </div>

  </div>

  <div class="page page--scanner">
    <header class="page__header"></header>
    <footer class="page__footer"></footer>
  </div>

  <script type="module" src="/js/scanner.js"></script>
</body>

</html>