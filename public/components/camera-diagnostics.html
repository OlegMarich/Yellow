<!DOCTYPE html>
<html lang="uk">

<head>
  <meta charset="UTF-8">
  <title>Camera Diagnostics</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
    }

    .ok {
      color: green;
    }

    .err {
      color: red;
    }

    video {
      width: 100%;
      max-width: 400px;
      background: #000;
      border-radius: 8px;
      margin-top: 10px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>

  <h2>–î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∫–∞–º–µ—Ä–∏</h2>
  <button id="run">–ó–∞–ø—É—Å—Ç–∏—Ç–∏ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫—É</button>

  <div id="log"></div>
  <video id="video" autoplay playsinline muted></video>

  <script>
    function log(msg, ok = true) {
      const div = document.createElement('div');
      div.className = ok ? 'ok' : 'err';
      div.textContent = msg;
      document.getElementById('log').appendChild(div);
    }

    document.getElementById('run').addEventListener('click', async () => {
      const video = document.getElementById('video');
      document.getElementById('log').innerHTML = '';

      log("üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é —Å–ø–∏—Å–æ–∫ –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤...");

      try {
        const devices = await navigator.mediaDevices.enumerateDevices();
        console.log(devices);

        const cams = devices.filter(d => d.kind === 'videoinput');
        if (cams.length === 0) {
          log("‚ùå –ö–∞–º–µ—Ä–∏ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ", false);
          return;
        } else {
          log(`‚úî –ó–Ω–∞–π–¥–µ–Ω–æ –∫–∞–º–µ—Ä: ${cams.length}`);
        }
      } catch (e) {
        log("‚ùå enumerateDevices –ø–æ–º–∏–ª–∫–∞: " + e, false);
      }

      log("üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏ (facingMode: environment)...");

      let stream = null;

      try {
        stream = await navigator.mediaDevices.getUserMedia({
          video: { facingMode: "environment" }
        });
        log("‚úî –ó–∞–¥–Ω—è –∫–∞–º–µ—Ä–∞ –ø—Ä–∞—Ü—é—î");
      } catch (e) {
        log("‚ö† –ù–µ –≤–¥–∞–ª–æ—Å—è —É–≤—ñ–º–∫–Ω—É—Ç–∏ –∑–∞–¥–Ω—é –∫–∞–º–µ—Ä—É: " + e.name);

        log("üîç –ü—Ä–æ–±—É—é fallback (video: true)...");
        try {
          stream = await navigator.mediaDevices.getUserMedia({ video: true });
          log("‚úî Fallback –∫–∞–º–µ—Ä–∞ –ø—Ä–∞—Ü—é—î");
        } catch (e2) {
          log("‚ùå Fallback —Ç–µ–∂ –Ω–µ –ø—Ä–∞—Ü—é—î: " + e2.name, false);
          return;
        }
      }

      video.srcObject = stream;

      log("üîç –ü–µ—Ä–µ–≤—ñ—Ä—è—é, —á–∏ –≤—ñ–¥–µ–æ –º–æ–∂–µ –≤—ñ–¥—Ç–≤–æ—Ä—é–≤–∞—Ç–∏—Å—è...");

      try {
        await video.play();
        log("‚úî –í—ñ–¥–µ–æ –≤—ñ–¥—Ç–≤–æ—Ä—é—î—Ç—å—Å—è");
      } catch (e) {
        log("‚ùå –í—ñ–¥–µ–æ –Ω–µ –º–æ–∂–µ –≤—ñ–¥—Ç–≤–æ—Ä–∏—Ç–∏—Å—è: " + e, false);
      }

      log("üéâ –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞");
    });
  </script>

</body>

</html>